
/*
 * Title: IceLink WebSync Extension for JavaScript
 * Version: 2.8.9
 * Copyright Frozen Mountain Software 2011+
 */

!function(e,t,n){if("function"==typeof define&&define.amd)define(e,t,n);else if("object"==typeof exports){for(var r=0;r<t.length;r++)require("./"+t[r]);module.exports=n()}else this[e]=n()}("fm.icelink.websync",["fm.websync","fm.websync.chat","fm","fm.icelink","fm.websync.subscribers"],function(){if("undefined"==typeof global||global.window||(global.window=global,global.document={cookie:""}),!window.fm)throw new Error("fm must be loaded before fm.icelink.websync.");if(!window.fm.icelink)throw new Error("fm.icelink must be loaded before fm.icelink.websync.");window.fm.icelink.websync||(window.fm.icelink.websync={}),fm.icelink.websync.getVersion=function(){return"2.8.9"};var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function r(){this.constructor=e}for(var s in t)n.call(t,s)&&(e[s]=t[s]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},n={}.hasOwnProperty;fm.icelink.websync.shouldLinkArgs=function(n){function r(){this.getJoinedPeer=e(this.getJoinedPeer,this),this.getInitiator=e(this.getInitiator,this);var t;return 1===arguments.length&&fm.util.isPlainObject(arguments[0])?(t=r.__super__.constructor.call(this),fm.util.attachProperties(this,arguments[0]),t):t=r.__super__.constructor.call(this)}return t(r,n),r.prototype.__initiator=!1,r.prototype.__joinedPeer=null,r.prototype.getInitiator=function(){return this.__initiator},r.prototype.getJoinedPeer=function(){return this.__joinedPeer},r}(fm.websync.baseSuccessArgs);var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function r(){this.constructor=e}for(var s in t)n.call(t,s)&&(e[s]=t[s]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},n={}.hasOwnProperty;fm.icelink.websync.joinConferenceCompleteArgs=function(n){function r(){this.getIsRejoin=e(this.getIsRejoin,this);var t;return 1===arguments.length&&fm.util.isPlainObject(arguments[0])?(t=r.__super__.constructor.call(this),fm.util.attachProperties(this,arguments[0]),t):t=r.__super__.constructor.call(this)}return t(r,n),r.prototype.__isRejoin=!1,r.prototype.getIsRejoin=function(){return this.__isRejoin},r}(fm.websync.baseCompleteArgs);var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function r(){this.constructor=e}for(var s in t)n.call(t,s)&&(e[s]=t[s]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},n={}.hasOwnProperty;fm.icelink.websync.joinConferenceFailureArgs=function(n){function r(){this.getIsRejoin=e(this.getIsRejoin,this),this.getConferenceChannel=e(this.getConferenceChannel,this);var t;return 1===arguments.length&&fm.util.isPlainObject(arguments[0])?(t=r.__super__.constructor.call(this),fm.util.attachProperties(this,arguments[0]),t):t=r.__super__.constructor.call(this)}return t(r,n),r.prototype.__conferenceChannel=null,r.prototype.__isRejoin=!1,r.prototype.getConferenceChannel=function(){return this.__conferenceChannel},r.prototype.getIsRejoin=function(){return this.__isRejoin},r}(fm.websync.baseFailureArgs);var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function r(){this.constructor=e}for(var s in t)n.call(t,s)&&(e[s]=t[s]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},n={}.hasOwnProperty;fm.icelink.websync.joinConferenceReceiveArgs=function(n){function r(){this.getPublishingPeer=e(this.getPublishingPeer,this);var t,n,s,i,o,a;return 1===arguments.length&&fm.util.isPlainObject(arguments[0])?(o=r.__super__.constructor.call(this),fm.util.attachProperties(this,arguments[0]),o):(t=arguments[0],i=arguments[1],s=arguments[2],n=arguments[3],a=arguments[4],o=r.__super__.constructor.call(this,t,i,s,n,a))}return t(r,n),r.prototype.__publishingPeer=null,r.prototype.getPublishingPeer=function(){return this.__publishingPeer},r}(fm.websync.subscribeReceiveArgs);var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function r(){this.constructor=e}for(var s in t)n.call(t,s)&&(e[s]=t[s]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},n={}.hasOwnProperty;fm.icelink.websync.joinConferenceSuccessArgs=function(n){function r(){this.getUsers=e(this.getUsers,this),this.getIsRejoin=e(this.getIsRejoin,this),this.getConferenceChannel=e(this.getConferenceChannel,this);var t;return 1===arguments.length&&fm.util.isPlainObject(arguments[0])?(t=r.__super__.constructor.call(this),fm.util.attachProperties(this,arguments[0]),t):t=r.__super__.constructor.call(this)}return t(r,n),r.prototype.__conferenceChannel=null,r.prototype.__isRejoin=!1,r.prototype.__users=null,r.prototype.getConferenceChannel=function(){return this.__conferenceChannel},r.prototype.getIsRejoin=function(){return this.__isRejoin},r.prototype.getUsers=function(){return this.__users},r}(fm.websync.baseSuccessArgs);var t=function(e,t){function r(){this.constructor=e}for(var s in t)n.call(t,s)&&(e[s]=t[s]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},n={}.hasOwnProperty;fm.icelink.websync.leaveConferenceCompleteArgs=function(e){function n(){var e;return 1===arguments.length&&fm.util.isPlainObject(arguments[0])?(e=n.__super__.constructor.call(this),fm.util.attachProperties(this,arguments[0]),e):e=n.__super__.constructor.call(this)}return t(n,e),n}(fm.websync.baseCompleteArgs);var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function r(){this.constructor=e}for(var s in t)n.call(t,s)&&(e[s]=t[s]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},n={}.hasOwnProperty;fm.icelink.websync.leaveConferenceArgs=function(n){function r(){this.setUnlinkAllOnSuccess=e(this.setUnlinkAllOnSuccess,this),this.setOnSuccess=e(this.setOnSuccess,this),this.setOnFailure=e(this.setOnFailure,this),this.setOnComplete=e(this.setOnComplete,this),this.setConferenceChannel=e(this.setConferenceChannel,this),this.getUnlinkAllOnSuccess=e(this.getUnlinkAllOnSuccess,this),this.getOnSuccess=e(this.getOnSuccess,this),this.getOnFailure=e(this.getOnFailure,this),this.getOnComplete=e(this.getOnComplete,this),this.getConferenceChannel=e(this.getConferenceChannel,this);var t,n;return 1===arguments.length&&fm.util.isPlainObject(arguments[0])?(n=r.__super__.constructor.call(this),this.setUnlinkAllOnSuccess(!0),fm.util.attachProperties(this,arguments[0]),n):0===arguments.length?(n=r.__super__.constructor.call(this),this.setUnlinkAllOnSuccess(!0),n):1===arguments.length?(t=arguments[0],r.call(this),this.setConferenceChannel(t),n):void 0}return t(r,n),r.prototype._conferenceChannel=null,r.prototype._onComplete=null,r.prototype._onFailure=null,r.prototype._onSuccess=null,r.prototype._unlinkAllOnSuccess=!1,r.prototype.getConferenceChannel=function(){return this._conferenceChannel},r.prototype.getOnComplete=function(){return this._onComplete},r.prototype.getOnFailure=function(){return this._onFailure},r.prototype.getOnSuccess=function(){return this._onSuccess},r.prototype.getUnlinkAllOnSuccess=function(){return this._unlinkAllOnSuccess},r.prototype.setConferenceChannel=function(){var e;return e=arguments[0],this._conferenceChannel=e},r.prototype.setOnComplete=function(){var e;return e=arguments[0],this._onComplete=e},r.prototype.setOnFailure=function(){var e;return e=arguments[0],this._onFailure=e},r.prototype.setOnSuccess=function(){var e;return e=arguments[0],this._onSuccess=e},r.prototype.setUnlinkAllOnSuccess=function(){var e;return e=arguments[0],this._unlinkAllOnSuccess=e},r}(fm.websync.baseInputArgs);var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function r(){this.constructor=e}for(var s in t)n.call(t,s)&&(e[s]=t[s]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},n={}.hasOwnProperty;fm.icelink.websync.joinConferenceArgs=function(n){function r(){this.setUnlinkOnUserLeave=e(this.setUnlinkOnUserLeave,this),this.setUnlinkExistingOnUserJoin=e(this.setUnlinkExistingOnUserJoin,this),this.setShouldLink=e(this.setShouldLink,this),this.setRejoin=e(this.setRejoin,this),this.setOnSuccess=e(this.setOnSuccess,this),this.setOnReceive=e(this.setOnReceive,this),this.setOnFailure=e(this.setOnFailure,this),this.setOnComplete=e(this.setOnComplete,this),this.setConferenceChannel=e(this.setConferenceChannel,this),this.setConference=e(this.setConference,this),this.getUnlinkOnUserLeave=e(this.getUnlinkOnUserLeave,this),this.getUnlinkExistingOnUserJoin=e(this.getUnlinkExistingOnUserJoin,this),this.getShouldLink=e(this.getShouldLink,this),this.getRejoin=e(this.getRejoin,this),this.getOnSuccess=e(this.getOnSuccess,this),this.getOnReceive=e(this.getOnReceive,this),this.getOnFailure=e(this.getOnFailure,this),this.getOnComplete=e(this.getOnComplete,this),this.getConferenceChannel=e(this.getConferenceChannel,this),this.getConference=e(this.getConference,this);var t,n,s;return 1===arguments.length&&fm.util.isPlainObject(arguments[0])?(s=r.__super__.constructor.call(this),this.setUnlinkExistingOnUserJoin(!0),this.setUnlinkOnUserLeave(!0),fm.util.attachProperties(this,arguments[0]),s):0===arguments.length?(s=r.__super__.constructor.call(this),this.setUnlinkExistingOnUserJoin(!0),this.setUnlinkOnUserLeave(!0),s):2===arguments.length?(n=arguments[0],t=arguments[1],r.call(this),this.setConferenceChannel(n),this.setConference(t),s):void 0}return t(r,n),r.prototype._conference=null,r.prototype._conferenceChannel=null,r.prototype._onComplete=null,r.prototype._onFailure=null,r.prototype._onReceive=null,r.prototype._onSuccess=null,r.prototype._rejoin=!1,r.prototype._shouldLink=null,r.prototype._unlinkExistingOnUserJoin=!1,r.prototype._unlinkOnUserLeave=!1,r.prototype.getConference=function(){return this._conference},r.prototype.getConferenceChannel=function(){return this._conferenceChannel},r.prototype.getOnComplete=function(){return this._onComplete},r.prototype.getOnFailure=function(){return this._onFailure},r.prototype.getOnReceive=function(){return this._onReceive},r.prototype.getOnSuccess=function(){return this._onSuccess},r.prototype.getRejoin=function(){return this._rejoin},r.prototype.getShouldLink=function(){return this._shouldLink},r.prototype.getUnlinkExistingOnUserJoin=function(){return this._unlinkExistingOnUserJoin},r.prototype.getUnlinkOnUserLeave=function(){return this._unlinkOnUserLeave},r.prototype.setConference=function(){var e;return e=arguments[0],this._conference=e},r.prototype.setConferenceChannel=function(){var e;return e=arguments[0],this._conferenceChannel=e},r.prototype.setOnComplete=function(){var e;return e=arguments[0],this._onComplete=e},r.prototype.setOnFailure=function(){var e;return e=arguments[0],this._onFailure=e},r.prototype.setOnReceive=function(){var e;return e=arguments[0],this._onReceive=e},r.prototype.setOnSuccess=function(){var e;return e=arguments[0],this._onSuccess=e},r.prototype.setRejoin=function(){var e;return e=arguments[0],this._rejoin=e},r.prototype.setShouldLink=function(){var e;return e=arguments[0],this._shouldLink=e},r.prototype.setUnlinkExistingOnUserJoin=function(){var e;return e=arguments[0],this._unlinkExistingOnUserJoin=e},r.prototype.setUnlinkOnUserLeave=function(){var e;return e=arguments[0],this._unlinkOnUserLeave=e},r}(fm.websync.baseInputArgs);var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function r(){this.constructor=e}for(var s in t)n.call(t,s)&&(e[s]=t[s]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},n={}.hasOwnProperty;fm.icelink.websync.leaveConferenceFailureArgs=function(n){function r(){this.getConferenceChannel=e(this.getConferenceChannel,this);var t;return 1===arguments.length&&fm.util.isPlainObject(arguments[0])?(t=r.__super__.constructor.call(this),fm.util.attachProperties(this,arguments[0]),t):t=r.__super__.constructor.call(this)}return t(r,n),r.prototype.__conferenceChannel=null,r.prototype.getConferenceChannel=function(){return this.__conferenceChannel},r}(fm.websync.baseFailureArgs);var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function r(){this.constructor=e}for(var s in t)n.call(t,s)&&(e[s]=t[s]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},n={}.hasOwnProperty;fm.icelink.websync.leaveConferenceSuccessArgs=function(n){function r(){this.getConferenceChannel=e(this.getConferenceChannel,this);var t;return 1===arguments.length&&fm.util.isPlainObject(arguments[0])?(t=r.__super__.constructor.call(this),fm.util.attachProperties(this,arguments[0]),t):t=r.__super__.constructor.call(this)}return t(r,n),r.prototype.__conferenceChannel=null,r.prototype.getConferenceChannel=function(){return this.__conferenceChannel},r}(fm.websync.baseSuccessArgs);var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function r(){this.constructor=e}for(var s in t)n.call(t,s)&&(e[s]=t[s]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},n={}.hasOwnProperty;fm.icelink.websync.state=function(n){function r(){this.setUnlinkOnUserLeave=e(this.setUnlinkOnUserLeave,this),this.setUnlinkExistingOnUserJoin=e(this.setUnlinkExistingOnUserJoin,this),this.setUnlinkAllOnLeaveSuccess=e(this.setUnlinkAllOnLeaveSuccess,this),this.setOnLeaveSuccess=e(this.setOnLeaveSuccess,this),this.setOnLeaveFailure=e(this.setOnLeaveFailure,this),this.setOnLeaveComplete=e(this.setOnLeaveComplete,this),this.setOnJoinSuccess=e(this.setOnJoinSuccess,this),this.setOnJoinReceive=e(this.setOnJoinReceive,this),this.setOnJoinFailure=e(this.setOnJoinFailure,this),this.setOnJoinComplete=e(this.setOnJoinComplete,this),this.setJoinShouldLink=e(this.setJoinShouldLink,this),this.setConferenceChannel=e(this.setConferenceChannel,this),this.setConference=e(this.setConference,this),this.setClient=e(this.setClient,this),this.publishOfferAnswer=e(this.publishOfferAnswer,this),this.publishCandidate=e(this.publishCandidate,this),this.getUnlinkOnUserLeave=e(this.getUnlinkOnUserLeave,this),this.getUnlinkExistingOnUserJoin=e(this.getUnlinkExistingOnUserJoin,this),this.getUnlinkAllOnLeaveSuccess=e(this.getUnlinkAllOnLeaveSuccess,this),this.getOnLeaveSuccess=e(this.getOnLeaveSuccess,this),this.getOnLeaveFailure=e(this.getOnLeaveFailure,this),this.getOnLeaveComplete=e(this.getOnLeaveComplete,this),this.getOnJoinSuccess=e(this.getOnJoinSuccess,this),this.getOnJoinReceive=e(this.getOnJoinReceive,this),this.getOnJoinFailure=e(this.getOnJoinFailure,this),this.getOnJoinComplete=e(this.getOnJoinComplete,this),this.getJoinShouldLink=e(this.getJoinShouldLink,this),this.getInstanceId=e(this.getInstanceId,this),this.getInstanceChannel=e(this.getInstanceChannel,this),this.getConferenceChannel=e(this.getConferenceChannel,this),this.getConference=e(this.getConference,this),this.getClient=e(this.getClient,this);var t;return 1===arguments.length&&fm.util.isPlainObject(arguments[0])?(t=r.__super__.constructor.call(this),fm.util.attachProperties(this,arguments[0]),t):t=r.__super__.constructor.call(this)}return t(r,n),r.prototype._client=null,r.prototype._conference=null,r.prototype._conferenceChannel=null,r.prototype._joinShouldLink=null,r.prototype._onJoinComplete=null,r.prototype._onJoinFailure=null,r.prototype._onJoinReceive=null,r.prototype._onJoinSuccess=null,r.prototype._onLeaveComplete=null,r.prototype._onLeaveFailure=null,r.prototype._onLeaveSuccess=null,r.prototype._unlinkAllOnLeaveSuccess=!1,r.prototype._unlinkExistingOnUserJoin=!1,r.prototype._unlinkOnUserLeave=!1,r.buildInstanceChannel=function(){var e,t;return e=arguments[0],t=arguments[1],fm.stringExtensions.concat("/fm.icelink.websync.instance",e,"/",t)},r.getCandidateTag=function(){return"fm.icelink.websync.candidate"},r.getConferenceKey=function(){return"fm.icelink.websync.state"},r.getOfferAnswerTag=function(){return"fm.icelink.websync.offeranswer"},r.prototype.getClient=function(){return this._client},r.prototype.getConference=function(){return this._conference},r.prototype.getConferenceChannel=function(){return this._conferenceChannel},r.prototype.getInstanceChannel=function(){return fm.icelink.websync.state.buildInstanceChannel(this.getConferenceChannel(),this.getInstanceId())},r.prototype.getInstanceId=function(){return this.getClient().getInstanceId().toString()},r.prototype.getJoinShouldLink=function(){return this._joinShouldLink},r.prototype.getOnJoinComplete=function(){return this._onJoinComplete},r.prototype.getOnJoinFailure=function(){return this._onJoinFailure},r.prototype.getOnJoinReceive=function(){return this._onJoinReceive},r.prototype.getOnJoinSuccess=function(){return this._onJoinSuccess},r.prototype.getOnLeaveComplete=function(){return this._onLeaveComplete},r.prototype.getOnLeaveFailure=function(){return this._onLeaveFailure},r.prototype.getOnLeaveSuccess=function(){return this._onLeaveSuccess},r.prototype.getUnlinkAllOnLeaveSuccess=function(){return this._unlinkAllOnLeaveSuccess},r.prototype.getUnlinkExistingOnUserJoin=function(){return this._unlinkExistingOnUserJoin},r.prototype.getUnlinkOnUserLeave=function(){return this._unlinkOnUserLeave},r.prototype.publishCandidate=function(){var e,t,n;return n=arguments[0],e=arguments[1],t=fm.icelink.websync.state.buildInstanceChannel(this.getConferenceChannel(),n),this.getClient().publish(new fm.websync.publishArgs(t,e.toJson(),fm.icelink.websync.state.getCandidateTag()))},r.prototype.publishOfferAnswer=function(){var e,t,n;return t=arguments[0],n=arguments[1],e=fm.icelink.websync.state.buildInstanceChannel(this.getConferenceChannel(),t),this.getClient().publish(new fm.websync.publishArgs(e,n.toJson(),fm.icelink.websync.state.getOfferAnswerTag()))},r.prototype.setClient=function(){var e;return e=arguments[0],this._client=e},r.prototype.setConference=function(){var e;return e=arguments[0],this._conference=e},r.prototype.setConferenceChannel=function(){var e;return e=arguments[0],this._conferenceChannel=e},r.prototype.setJoinShouldLink=function(){var e;return e=arguments[0],this._joinShouldLink=e},r.prototype.setOnJoinComplete=function(){var e;return e=arguments[0],this._onJoinComplete=e},r.prototype.setOnJoinFailure=function(){var e;return e=arguments[0],this._onJoinFailure=e},r.prototype.setOnJoinReceive=function(){var e;return e=arguments[0],this._onJoinReceive=e},r.prototype.setOnJoinSuccess=function(){var e;return e=arguments[0],this._onJoinSuccess=e},r.prototype.setOnLeaveComplete=function(){var e;return e=arguments[0],this._onLeaveComplete=e},r.prototype.setOnLeaveFailure=function(){var e;return e=arguments[0],this._onLeaveFailure=e},r.prototype.setOnLeaveSuccess=function(){var e;return e=arguments[0],this._onLeaveSuccess=e},r.prototype.setUnlinkAllOnLeaveSuccess=function(){var e;return e=arguments[0],this._unlinkAllOnLeaveSuccess=e},r.prototype.setUnlinkExistingOnUserJoin=function(){var e;return e=arguments[0],this._unlinkExistingOnUserJoin=e},r.prototype.setUnlinkOnUserLeave=function(){var e;return e=arguments[0],this._unlinkOnUserLeave=e},r}(fm.object),fm.icelink.websync.clientExtensions=function(){function e(){var t;return 1===arguments.length&&fm.util.isPlainObject(arguments[0])?(t=e.__super__.constructor.call(this),fm.util.attachProperties(this,arguments[0]),t):void 0}return e._onLinkCandidateEvent=null,e._onLinkOfferAnswerEvent=null,e.joinConference=function(){var t,n,r,s,i,o,a,u;if(n=arguments[0],o=arguments[1],r=o.getConference(),s=o.getConferenceChannel(),fm.stringExtensions.isNullOrEmpty(s))throw new Error("Conference channel cannot be null.");if(fm.global.equals(r,null))throw new Error("Conference cannot be null.");return u=new fm.icelink.websync.state,u.setClient(n),u.setConference(r),u.setConferenceChannel(s),u.setOnJoinSuccess(o.getOnSuccess()),u.setOnJoinFailure(o.getOnFailure()),u.setOnJoinComplete(o.getOnComplete()),u.setOnJoinReceive(o.getOnReceive()),u.setUnlinkExistingOnUserJoin(o.getUnlinkExistingOnUserJoin()),u.setUnlinkOnUserLeave(o.getUnlinkOnUserLeave()),u.setJoinShouldLink(o.getShouldLink()),a=u,n.setDynamicValue(a.getConferenceChannel(),a),n.setDynamicValue(a.getInstanceChannel(),a),r.setDynamicValue(fm.icelink.websync.state.getConferenceKey(),a),t=new fm.websync.chat.joinArgs([a.getConferenceChannel(),a.getInstanceChannel()],"fm.icelink.websync"),t.setUserId(a.getInstanceId()),t.setUserNickname("fm.icelink.websync"),t.setRequestUrl(o.getRequestUrl()),t.setSynchronous(o.getSynchronous()),t.setOnSuccess(e.onJoinSuccess),t.setOnFailure(e.onJoinFailure),t.setOnReceive(e.onJoinReceive),t.setOnUserJoin(e.onUserJoin),t.setOnUserLeave(e.onUserLeave),t.setDynamicProperties(o.getDynamicProperties()),i=t,i.copyExtensions(o),fm.websync.chat.clientExtensions.join(n,i)},e.leaveConference=function(){var t,n,r,s,i,o,a,u,l;if(r=arguments[0],u=arguments[1],s=u.getConferenceChannel(),fm.stringExtensions.isNullOrEmpty(s))throw new Error("Conference channel cannot be null.");return i=fm.global.tryCast(r.getDynamicValue(s),fm.icelink.websync.state),fm.global.equals(i,null)?(t=new fm.websync.chat.leaveSuccessArgs,t.setClient(r),t.setDynamicProperties(u.getDynamicProperties()),o=t,o.copyExtensions(u),l=new fm.icelink.websync.state,l.setClient(r),l.setConferenceChannel(s),l.setOnLeaveSuccess(u.getOnSuccess()),l.setOnLeaveFailure(u.getOnFailure()),l.setOnLeaveComplete(u.getOnComplete()),fm.icelink.websync.clientExtensions.raiseLeaveSuccess(l,o),r):(i.setUnlinkAllOnLeaveSuccess(u.getUnlinkAllOnSuccess()),i.setOnLeaveSuccess(u.getOnSuccess()),i.setOnLeaveFailure(u.getOnFailure()),i.setOnLeaveComplete(u.getOnComplete()),n=new fm.websync.chat.leaveArgs([i.getConferenceChannel(),i.getInstanceChannel()],"fm.icelink.websync"),n.setRequestUrl(u.getRequestUrl()),n.setSynchronous(u.getSynchronous()),n.setOnSuccess(e.onLeaveSuccess),n.setOnFailure(e.onLeaveFailure),n.setDynamicProperties(u.getDynamicProperties()),a=n,a.copyExtensions(u),fm.websync.chat.clientExtensions.leave(r,a))},e.onJoinFailure=function(){var e,t;return t=arguments[0],e=fm.global.tryCast(t.getClient().getDynamicValue(t.getChannel()),fm.icelink.websync.state),fm.global.equals(e,null)?fm.log.error("The IceLink/WebSync extension state was removed unexpectedly. WebSync could not join the conference channel, but without an extension state, a callback cannot be invoked."):(e.getClient().unsetDynamicValue(e.getConferenceChannel()),e.getClient().unsetDynamicValue(e.getInstanceChannel()),e.getConference().unsetDynamicValue(fm.icelink.websync.state.getConferenceKey()),fm.icelink.websync.clientExtensions.raiseJoinFailure(e,t),e.setConference(null))},e.onJoinReceive=function(){var e,t,n,r,s;return n=arguments[0],t=fm.global.tryCast(n.getClient().getDynamicValue(n.getChannel()),fm.icelink.websync.state),fm.global.equals(t,null)?fm.log.error("The IceLink/WebSync extension state was removed unexpectedly. WebSync received a message, but without an extension state, the message must be discarded."):fm.global.equals(n.getChannel(),t.getConferenceChannel())?fm.icelink.websync.clientExtensions.raiseJoinReceive(t,n):fm.global.equals(n.getPublishingUser().getUserNickname(),"fm.icelink.websync")?fm.global.equals(n.getTag(),fm.icelink.websync.state.getOfferAnswerTag())?(s=n.getPublishingUser().getUserId(),e=n.getPublishingUser().getBoundRecords(),r=fm.icelink.offerAnswer.fromJson(n.getDataJson()),r.getIsOffer()?fm.icelink.websync.clientExtensions.raiseShouldLink(t,n,s,e,!1)?t.getConference().receiveOfferAnswer(r,s,e):fm.log.debug("A remote WebSync client sent an offer, but an answer will not be created (denied by user code)."):t.getConference().receiveOfferAnswer(r,s,e)):fm.global.equals(n.getTag(),fm.icelink.websync.state.getCandidateTag())?t.getConference().receiveCandidate(fm.icelink.candidate.fromJson(n.getDataJson()),n.getPublishingUser().getUserId()):fm.icelink.websync.clientExtensions.raiseJoinReceive(t,n):fm.icelink.websync.clientExtensions.raiseJoinReceive(t,n)},e.onJoinSuccess=function(){var e,t;return t=arguments[0],e=fm.global.tryCast(t.getClient().getDynamicValue(t.getChannel()),fm.icelink.websync.state),fm.global.equals(e,null)?fm.log.error("The IceLink/WebSync extension state was removed unexpectedly. WebSync joined the conference channel, but without an extension state, a callback cannot be invoked."):(e.getConference().removeOnLinkOfferAnswer(fm.icelink.websync.clientExtensions._onLinkOfferAnswerEvent),e.getConference().removeOnLinkCandidate(fm.icelink.websync.clientExtensions._onLinkCandidateEvent),e.getConference().addOnLinkOfferAnswer(fm.icelink.websync.clientExtensions._onLinkOfferAnswerEvent),e.getConference().addOnLinkCandidate(fm.icelink.websync.clientExtensions._onLinkCandidateEvent),fm.icelink.websync.clientExtensions.raiseJoinSuccess(e,t))},e.onLeaveFailure=function(){var e,t;return t=arguments[0],e=fm.global.tryCast(t.getClient().getDynamicValue(t.getChannel()),fm.icelink.websync.state),fm.global.equals(e,null)?fm.log.error("The IceLink/WebSync extension state was removed unexpectedly. WebSync could not leave the conference channel, but without an extension state, a callback cannot be invoked."):fm.icelink.websync.clientExtensions.raiseLeaveFailure(e,t)},e.onLeaveSuccess=function(){var e,t;return t=arguments[0],e=fm.global.tryCast(t.getClient().getDynamicValue(t.getChannel()),fm.icelink.websync.state),fm.global.equals(e,null)?fm.log.error("The IceLink/WebSync extension state was removed unexpectedly. WebSync left the conference channel, but without an extension state, a callback cannot be invoked."):(e.getConference().removeOnLinkCandidate(fm.icelink.websync.clientExtensions._onLinkCandidateEvent),e.getConference().removeOnLinkOfferAnswer(fm.icelink.websync.clientExtensions._onLinkOfferAnswerEvent),e.getClient().unsetDynamicValue(e.getConferenceChannel()),e.getClient().unsetDynamicValue(e.getInstanceChannel()),e.getConference().unsetDynamicValue(fm.icelink.websync.state.getConferenceKey()),e.getUnlinkAllOnLeaveSuccess()&&e.getConference().unlinkAll("Local WebSync client left the conference."),fm.icelink.websync.clientExtensions.raiseLeaveSuccess(e,t),e.setConference(null))},e.onLinkCandidate=function(){var e,t;return t=arguments[0],e=fm.global.tryCast(t.getConference().getDynamicValue(fm.icelink.websync.state.getConferenceKey()),fm.icelink.websync.state),fm.global.equals(e,null)?fm.log.error("The IceLink/WebSync extension state was removed unexpectedly. IceLink generated a candidate, but without an extension state, the candidate must be discarded."):e.publishCandidate(fm.icelink.websync.baseLinkArgsExtensions.getPeerClient(t).getInstanceId(),t.getCandidate())},e.onLinkOfferAnswer=function(){var e,t;return t=arguments[0],e=fm.global.tryCast(t.getConference().getDynamicValue(fm.icelink.websync.state.getConferenceKey()),fm.icelink.websync.state),fm.global.equals(e,null)?fm.log.error("The IceLink/WebSync extension state was removed unexpectedly. IceLink generated an offer/answer, but without an extension state, the offer/answer must be discarded."):e.publishOfferAnswer(fm.icelink.websync.baseLinkArgsExtensions.getPeerClient(t).getInstanceId(),t.getOfferAnswer())},e.onUserJoin=function(){var e,t,n,r;return n=arguments[0],fm.global.equals(n.getJoinedUser().getUserNickname(),"fm.icelink.websync")?(t=fm.global.tryCast(n.getClient().getDynamicValue(n.getChannel()),fm.icelink.websync.state),fm.global.equals(t,null)?void 0:(r=n.getJoinedUser().getUserId(),e=n.getSubscribedClient().getBoundRecords(),fm.icelink.websync.clientExtensions.raiseShouldLink(t,n,r,e,!0)?t.getConference().link(r,e,t.getUnlinkExistingOnUserJoin()):fm.log.debug("A remote WebSync client joined the conference, but an offer will not be created (denied by user code)."))):fm.log.error("The IceLink/WebSync extension state was removed unexpectedly. A remote WebSync client joined the conference, but without an extension state, a link cannot be created.")},e.onUserLeave=function(){var e,t;return t=arguments[0],fm.global.equals(t.getLeftUser().getUserNickname(),"fm.icelink.websync")?(e=fm.global.tryCast(t.getClient().getDynamicValue(t.getChannel()),fm.icelink.websync.state),!fm.global.equals(e,null)&&e.getUnlinkOnUserLeave()?e.getConference().unlink(t.getLeftUser().getUserId(),"Remote WebSync client left the conference."):void 0):fm.log.error("The IceLink/WebSync extension state was removed unexpectedly. A remote WebSync client left the conference, but without an extension state, the link cannot be dropped.")},e.raiseJoinFailure=function(){var e,t,n,r,s,i,o,a,u,l,c,h,p;if(p=arguments[0],r=arguments[1],c=p.getOnJoinFailure(),!fm.global.equals(c,null)){e=new fm.icelink.websync.joinConferenceFailureArgs,e.__conferenceChannel=p.getConferenceChannel(),e.__isRejoin=r.getIsRejoin(),e.setRetry(r.getRetry()),e.setClient(r.getClient()),e.setException(r.getException()),e.setTimestamp(r.getTimestamp()),e.setDynamicProperties(r.getDynamicProperties()),h=e,h.copyExtensions(r);try{c(h)}catch(s){a=s,o=a,r.getClient().raiseUnhandledException(o)||fm.asyncException.asyncThrow(o,"Client -> Join -> OnFailure")}finally{}r.setRetry(h.getRetry())}if(l=p.getOnJoinComplete(),!fm.global.equals(l,null)){n=new fm.icelink.websync.joinConferenceCompleteArgs,n.__isRejoin=r.getIsRejoin(),n.setClient(r.getClient()),n.setTimestamp(r.getTimestamp()),n.setDynamicProperties(r.getDynamicProperties()),t=n,t.copyExtensions(r);try{return l(t)}catch(i){if(u=i,o=u,!r.getClient().raiseUnhandledException(o))return fm.asyncException.asyncThrow(o,"Client -> Join -> OnComplete")}finally{}}},e.raiseJoinReceive=function(){var e,t,n,r,s;return s=arguments[0],t=arguments[1],n=s.getOnJoinReceive(),fm.global.equals(n,null)?void 0:(e=new fm.icelink.websync.joinConferenceReceiveArgs(t.getChannel(),t.getDataJson(),t.getDataBytes(),t.getConnectionType(),t.getReconnectAfter()),e.__publishingPeer=new fm.icelink.websync.peerClient(t.getPublishingUser().getUserId(),t.getPublishingClient().getBoundRecords()),e.setClient(t.getClient()),e.setTimestamp(t.getTimestamp()),e.setDynamicProperties(t.getDynamicProperties()),r=e,r.copyExtensions(t),n(r))},e.raiseJoinSuccess=function(){var e,t,n,r,s,i,o,a,u,l,c,h,p;if(p=arguments[0],r=arguments[1],c=p.getOnJoinSuccess(),!fm.global.equals(c,null)){e=new fm.icelink.websync.joinConferenceSuccessArgs,e.__conferenceChannel=p.getConferenceChannel(),e.__users=r.getUsers(),e.__isRejoin=r.getIsRejoin(),e.setClient(r.getClient()),e.setTimestamp(r.getTimestamp()),e.setDynamicProperties(r.getDynamicProperties()),h=e,h.copyExtensions(r);try{c(h)}catch(s){a=s,o=a,r.getClient().raiseUnhandledException(o)||fm.asyncException.asyncThrow(o,"Client -> Join -> OnSuccess")}finally{}}if(l=p.getOnJoinComplete(),!fm.global.equals(l,null)){n=new fm.icelink.websync.joinConferenceCompleteArgs,n.__isRejoin=r.getIsRejoin(),n.setClient(r.getClient()),n.setTimestamp(r.getTimestamp()),n.setDynamicProperties(r.getDynamicProperties()),t=n,t.copyExtensions(r);try{return l(t)}catch(i){if(u=i,o=u,!r.getClient().raiseUnhandledException(o))return fm.asyncException.asyncThrow(o,"Client -> Join -> OnComplete")}finally{}}},e.raiseLeaveFailure=function(){var e,t,n,r,s,i,o,a,u,l,c,h,p;if(p=arguments[0],r=arguments[1],c=p.getOnLeaveFailure(),!fm.global.equals(c,null)){e=new fm.icelink.websync.leaveConferenceFailureArgs,e.__conferenceChannel=p.getConferenceChannel(),e.setRetry(r.getRetry()),e.setClient(r.getClient()),e.setException(r.getException()),e.setTimestamp(r.getTimestamp()),e.setDynamicProperties(r.getDynamicProperties()),h=e,h.copyExtensions(r);try{c(h)}catch(s){a=s,o=a,r.getClient().raiseUnhandledException(o)||fm.asyncException.asyncThrow(o,"Client -> Leave -> OnFailure")}finally{}r.setRetry(h.getRetry())}if(l=p.getOnLeaveComplete(),!fm.global.equals(l,null)){n=new fm.icelink.websync.leaveConferenceCompleteArgs,n.setClient(r.getClient()),n.setTimestamp(r.getTimestamp()),n.setDynamicProperties(r.getDynamicProperties()),t=n,t.copyExtensions(r);try{return l(t)}catch(i){if(u=i,o=u,!r.getClient().raiseUnhandledException(o))return fm.asyncException.asyncThrow(o,"Client -> Leave -> OnComplete")}finally{}}},e.raiseLeaveSuccess=function(){var e,t,n,r,s,i,o,a,u,l,c,h,p;if(p=arguments[0],r=arguments[1],c=p.getOnLeaveSuccess(),!fm.global.equals(c,null)){
e=new fm.icelink.websync.leaveConferenceSuccessArgs,e.__conferenceChannel=p.getConferenceChannel(),e.setClient(r.getClient()),e.setTimestamp(r.getTimestamp()),e.setDynamicProperties(r.getDynamicProperties()),h=e,h.copyExtensions(r);try{c(h)}catch(s){a=s,o=a,r.getClient().raiseUnhandledException(o)||fm.asyncException.asyncThrow(o,"Client -> Leave -> OnSuccess")}finally{}}if(l=p.getOnLeaveComplete(),!fm.global.equals(l,null)){n=new fm.icelink.websync.leaveConferenceCompleteArgs,n.setClient(r.getClient()),n.setTimestamp(r.getTimestamp()),n.setDynamicProperties(r.getDynamicProperties()),t=n,t.copyExtensions(r);try{return l(t)}catch(i){if(u=i,o=u,!r.getClient().raiseUnhandledException(o))return fm.asyncException.asyncThrow(o,"Client -> Leave -> OnComplete")}finally{}}},e.raiseShouldLink=function(){var e,t,n,r,s,i,o,a;return o=arguments[0],r=arguments[1],a=arguments[2],n=arguments[3],s=arguments[4],i=o.getJoinShouldLink(),fm.global.equals(i,null)?!0:(t=new fm.icelink.websync.shouldLinkArgs,t.__joinedPeer=new fm.icelink.websync.peerClient(a,n),t.__initiator=s,t.setClient(r.getClient()),t.setTimestamp(r.getTimestamp()),t.setDynamicProperties(r.getDynamicProperties()),e=t,e.copyExtensions(r),i(e))},fm.websync.client.prototype.joinConference=function(){var e;return e=arguments[0],Array.prototype.splice.call(arguments,0,0,this),fm.icelink.websync.clientExtensions.joinConference.apply(this,arguments)},fm.websync.client.prototype.leaveConference=function(){var e;return e=arguments[0],Array.prototype.splice.call(arguments,0,0,this),fm.icelink.websync.clientExtensions.leaveConference.apply(this,arguments)},e._onLinkOfferAnswerEvent=e.onLinkOfferAnswer,e._onLinkCandidateEvent=e.onLinkCandidate,e}(),fm.icelink.websync.baseLinkArgsExtensions=function(){function e(){var t;return 1===arguments.length&&fm.util.isPlainObject(arguments[0])?(t=e.__super__.constructor.call(this),fm.util.attachProperties(this,arguments[0]),t):void 0}return e.getPeerClient=function(){var e;return e=arguments[0],new fm.icelink.websync.peerClient(e.getPeerId(),e.getPeerState())},fm.icelink.baseLinkArgs.prototype.getPeerClient=function(){return Array.prototype.splice.call(arguments,0,0,this),fm.icelink.websync.baseLinkArgsExtensions.getPeerClient.apply(this,arguments)},e}();var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function r(){this.constructor=e}for(var s in t)n.call(t,s)&&(e[s]=t[s]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},n={}.hasOwnProperty;fm.icelink.websync.peerClient=function(n){function r(){this.setInstanceId=e(this.setInstanceId,this),this.setBoundRecords=e(this.setBoundRecords,this),this.getInstanceId=e(this.getInstanceId,this),this.getBoundRecords=e(this.getBoundRecords,this);var t,n,s;return 1===arguments.length&&fm.util.isPlainObject(arguments[0])?(n=r.__super__.constructor.call(this),fm.util.attachProperties(this,arguments[0]),n):(s=arguments[0],t=arguments[1],n=r.__super__.constructor.call(this),this.setInstanceId(s),this.setBoundRecords(t),n)}return t(r,n),r.prototype._boundRecords=null,r.prototype._instanceId=null,r.prototype.getBoundRecords=function(){return this._boundRecords},r.prototype.getInstanceId=function(){return this._instanceId},r.prototype.setBoundRecords=function(){var e;return e=arguments[0],this._boundRecords=e},r.prototype.setInstanceId=function(){var e;return e=arguments[0],this._instanceId=e},r}(fm.object);var r,s,i,o,a;for(a=["joinConference","leaveConference"],r=function(e){var t;return t=fm.websync.client.prototype[e],fm.websync.client.prototype[e]=function(){var n;return 1===arguments.length&&fm.util.isPlainObject(arguments[0])?(n=arguments[0],t.call(this,new fm.icelink.websync[e+"Args"](n))):t.apply(this,arguments)}},s=0,i=a.length;i>s;s++)o=a[s],r(o);return fm.icelink.websync});